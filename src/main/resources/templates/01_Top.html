<html lang="ja">
<head>
<meta charset="UTF-8">
<title>チーム開発・テスト</title>
<script th:src="@{/js/script.js}"></script>
<script th:src="@{/js/jquery-3.5.0.min.js}"></script>
<link th:href="@{/css/style.css}" rel="stylesheet" type="text/css">
</head>

<header id="0">
  <!-- タイトル -->
<p id="site_title">
  <h1><span>アニメキャラの解析システム</span></h1>
</p>
</header>
<!-- タイトル ここまで -->

<body>
<!-- 説明文 -->
<div class="verticalLine">
  <p>
    深層学習（ディープラーニング）を使って、キャラクターの顔認識をおこないます。
    <br>解析したい画像を選択してください。
  </p>
</div>
<!-- 説明文 ここまで -->

<form action="upload.php" th:action="@{/result}" th:object="${imageForm}" method="post" enctype="multipart/form-data">
  <div id="target" class="dottedSquare hover" onclick="$('#selectImage').click()">
    <p>枠線内に画像をドラッグするか、ファイルを選択してください。</p>
    <img id="preview">
  </div>
  <p><input type="file" name="upfile" id="selectImage" accept="image/*" capture="camera"  th:field="*{image}" /></p>
  <p><input type="submit" name="analysis" value="解析実行" /></p>
</form>

</body>

<!-- javascript -->
<script type="text/javascript">
<!-- ドロップした画像のプレビュー処理 -->
var target = document.getElementById('target');

target.addEventListener('dragover', function (e) {
	e.preventDefault();
	e.stopPropagation();
	e.dataTransfer.dropEffect = 'copy';
});

target.addEventListener('drop', function (e) {
	e.stopPropagation();
	e.preventDefault();
    var files = e.dataTransfer.files;
	document.getElementById('selectImage').files = files;
	previewFile(files[0]);
});

<!-- ファイル選択した画像のプレビュー処理 -->
$('#selectImage').on('change', function (e) {
    var files = document.getElementById('selectImage').files;
	previewFile(files[0]);
});

function previewFile(file) {
    /* FileReaderで読み込み、プレビュー画像を表示。 */
    var fr = new FileReader();
    fr.readAsDataURL(file);
    fr.onload = function() {
        $("#preview").attr('src', fr.result);
    };
}

</script>
